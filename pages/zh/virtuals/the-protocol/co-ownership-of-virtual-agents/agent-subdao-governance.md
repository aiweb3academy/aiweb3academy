# 智能体 SubDAO 治理

> 即将实现

## 治理

随着人工智能智能体成为罗布乐思（Roblox）、抖音（TikTok）和电报（Telegram）等跨平台应用程序不可或缺的一部分，保持顶级模型质量对于实现收益最大化和用户满意度提升至关重要。为确保这些人工智能智能体始终符合高性能标准，Virtuals 协议引入了**智能体子去中心化自治组织治理（Agent SubDAO Governance）**框架——这是一个旨在管理和提升人工智能模型质量的去中心化系统。

这种治理模式授权**验证者**在人工智能模型部署前对其进行监督、验证和批准，确保仅使用最优秀的模型。验证者会根据其决策质量获得奖励或受到惩罚，其投票权由**流动性提供者（LPs）**质押的代币决定。这种激励机制的协同作用创建了一个系统，在这个系统中，所有利益相关者都有动力维持最高的模型标准，从而改善用户体验并提升收益潜力。

### 智能体 SubDAO 的结构

智能体 SubDAO 由以下部分组成：
- **流动性提供者（LPs）**：将其 LP 代币质押给可信赖验证者的流动性提供者。流动性提供者受益于模型质量的提升，进而从智能体更高的创收能力中获利。
- **验证者**：负责评估智能体所使用的人工智能模型的质量和性能。验证者会根据其投票权获得奖励或受到惩罚，其投票权由流动性提供者（LPs）质押的代币决定。该机制将遵循委托权益证明（DPos）的代币委托方式。

## 质押与奖励机制

### 奖励分配

智能体 SubDAO 治理模型中的奖励来自两个主要来源：
- **智能体推理支付**：应用程序向每个人工智能智能体支付的推理费用会分配到智能体去中心化自治组织（AgentDAO）的资金库中。这些推理支付用于回购和销毁智能体代币。
- **协议奖励发放**：协议会向排行榜上表现最佳的智能体资金库发放奖励。这一机制旨在维护和提升整个协议中智能体的质量。验证者在获得的质押权力支持下，因其在维持质量标准方面的持续努力而获得奖励。这些奖励激励验证者仔细评估人工智能模型，确保它们符合协议的性能标准。
- **交易费用**：所有涉及智能体代币的交易都将产生 1% 的税费（根据未来条件可能会降低）。这种税费旨在为每个智能体积累资金，以支持诸如推理和 GPU 使用等成本，因为智能体需要时间来积累收入和现金流。鉴于所有智能体代币都是公平推出的，这种机制在不损害公平推出原则的前提下，为激励智能体提供了一种可持续的方式。

**注意**：目前，向智能体支付的推理费用用于在公开市场回购代币，然后将其销毁。智能体去中心化自治组织（AgentDAO）机制可能在后期进行调整。

### 验证者奖励

验证者根据其投票权获得奖励。投票权越高（来自更多委托的 LP 代币）的验证者获得的奖励越高。

### 惩罚系统

验证者也可能受到惩罚。如果验证者批准的模型未能达到质量标准或对应用程序产生负面影响，该验证者可能会损失部分质押代币，或因失去投票权而受到惩罚。这一系统确保验证者对其批准的模型负责，鼓励他们关注质量和可靠性。

## 治理机制

SubDAO 中的验证者将对人工智能模型的部署和升级进行审核和批准。通过参与治理过程，验证者有助于维持质量标准，确保不会部署质量欠佳的模型，从而保护应用程序的完整性并确保最佳的用户体验。

验证者只能通过流动性提供者的委托获得投票权。这种委托的投票权决定了他们对该 SubDAO 治理决策的影响力。验证者拥有的投票权越多，他们对模型质量决策的影响力就越大。

### 投票过程
投票过程允许验证者就模型升级、验证和其他关键治理事项的提案进行投票。投票权重根据验证者的投票权确定，而投票权由质押在该验证者处的代币总量决定。获得多数投票的提案将被批准并实施，使 SubDAO 能够：
- **升级模型**：提出新模型，由验证者进行审核和投票。如果获得批准，该模型将被实施。
- **执行惩罚**：验证者对允许低质量模型通过的其他验证者进行惩罚投票，追究其责任并维持整体质量。

### 模型升级
在验证模型时，验证者会匿名收到两个模型进行比较。他们会与每对模型进行 10 轮交互，选择更好的回复。10 轮之后，提交带有最终结果的投票。

模型比较过程中的匿名性可防止验证者和贡献者之间的串通和偏见，确保模型选择过程的公平性。

Virtual 协议选择了埃洛评级系统（Elo Rating System）进行模型比较。

#### 优化埃洛评级系统（Elo Rating System）

基于 [Fastchat](https://github.com/lm-sys/FastChat) 等先驱奠定的[基础](https://colab.research.google.com/drive/1RAWb22-PFNI-X1gPVzc927SGUdfr6nsR?usp=sharing)，我们认识到传统埃洛评级在稳定性方面存在挑战。因此，我们实施了一个经过优化的、自举版本的埃洛评级系统，以提高模型验证结果的稳定性和可靠性。

一个标准的埃洛评级机制如下：

```python
def compute_elo(battles, K=4, SCALE=400, BASE=10, INIT_RATING=1000):
    rating = defaultdict(lambda: INIT_RATING)

    for rd, model_a, model_b, winner in battles[['model_a','model_b', 'winner']].itertuples():
        ra = rating[model_a]
        rb = rating[model_b]
        ea = 1 / (1 + BASE ** ((rb - ra) / SCALE))
        eb = 1 / (1 + BASE ** ((ra - rb) / SCALE))
        if winner == "model_a":
            sa = 1
        elif winner == "model_b":
            sa = 0
        elif winner == "tie" or winner == "tie (bothbad)":
            sa = 0.5
        else:
            raise Exception(f"unexpected vote {winner}")
        rating[model_a] += K * (sa - ea)
        rating[model_b] += K * (1 - sa - eb)

    return rating


def preety_print_elo_ratings(ratings):
    df = pd.DataFrame([
        [n, elo_ratings[n]] for n in elo_ratings.keys()
    ], columns=["Model", "Elo rating"]).sort_values("Elo rating", ascending=False).reset_index(drop=True)
    df["Elo rating"] = (df["Elo rating"] + 0.5).astype(int)
    df.index = df.index + 1
    return df


elo_ratings = compute_elo(battles)
preety_print_elo_ratings(elo_ratings)
```

### 数据集贡献

当一个模型使用他人贡献的数据集进行微调时，该模型获得的埃洛评级表明了该数据集的质量。影响分数由提议模型与现有模型之间的分数差异得出，它决定了在使用该数据集进行微调后，提议模型是否更优。这使得 Virtual 协议能够为贡献的数据集制定标准，并拒绝那些影响较小的数据集。
